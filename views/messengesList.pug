<!DOCTYPE html>
html(lang="en")
    head
        meta(charset="UTF-8")
        meta(name="viewport", content="width=device-width, initial-scale=1.0")
        meta(http-equiv="X-UA-Compatible", content="ie=edge")
        title MYFORUM | Messenges
        link(rel='stylesheet' href='../../../../css/bootstrap.min.css')
        link(rel="shortcut icon", href="../../../../favicon.ico")
        link(rel='stylesheet' href='../../../../fonts/fonts.css')
        link(rel='stylesheet' href='../../../../css/messengesList.css')
    body
        nav.navbar.navbar-expand-lg.navbar-light.bg-light
            a.navbar-brand.logo(href='/home')
                span.logo-icon
                    img(src='../../../../img/logo-icon.svg' alt='icon')
                span.logo-text
                span MY
                | FORUM
            button.navbar-toggler(type='button' data-toggle='collapse' data-target='#navbarSupportedContent' aria-controls='navbarSupportedContent' aria-expanded='false' aria-label='Toggle navigation')
                span.navbar-toggler-icon
        
            #navbarSupportedContent.collapse.navbar-collapse
                ol.breadcrumb
                    li.breadcrumb-item
                        a(href="/forum") Categories
                    li.breadcrumb-item
                        a(href='/forum/c/' + thm.categoryId._id) #{thm.categoryId.title}
                    li.breadcrumb-item.active(aria-current='page') #{thm.name}
                ul.navbar-nav.mr-auto.navul
                    li.nav-item
                        a.nav-link(href='/home') Home
                    li.nav-item.active
                        a.nav-link(href='/forum') Forum
                    li.nav-item
                        a.nav-link(href='#') About
                if !sdata
                    form.form-inline.my-2.my-lg-0(name="authentfication")
                        input.form-control.mr-sm-2(type='login' placeholder='Login' name='login')
                        input.form-control.mr-sm-2(type='password' placeholder='Password' name='pass')
                        button.btn.btn-outline-success.my-2.my-sm-0(type='submit') Sign On
                        button.btn.btn-outline-primary.my-2.my-sm-0.btn-signin(type='button') Sign In
                else
                    a.nav-link(href="#") #{sdata.login}
        .container
            .row.firstRow
                .card.mb-3.mycard
                    .row
                        .col-lg-1.userAvatar
                            img.card-img(src='../../../../img/avatars/' + thm.create_userId.avatar alt="...")
                            a.aplogin(href="#")
                                p.plogin #{thm.create_userId.login}
                        .col-lg-11
                            .card-body.text-center.align-middle
                                h5.card-title.overflow-hidden #{thm.name}
                                p.card-text.overflow-hidden.contentTHM.text-justify #{thm.content}
                                p.card-text
                                    small.text-muted #{thm.create_date}
            hr    

            each msg in msgs
                .row
                    .card.mb-3.mycard
                        .row
                            .col-lg-1.userAvatar
                                img.card-img(src='../../../../img/avatars/' + msg.create_userId.avatar alt="...")
                                a.aplogin(href="#")
                                    p.plogin #{msg.create_userId.login}
                            .col-lg-11
                                .card-body.text-center.align-middle
                                    p.card-text.overflow-hidden.contentTHM.text-justify #{msg.content}
                                    p.card-text
                                        small.text-muted #{msg.create_date}
            hr

            .row
                .card.mb-3.mycard
                    .row
                        .col-lg-12
                            .card-body.text-center.align-middle
                                textarea.form-control(id="exampleFormControlTextarea1" rows="3")
                                p.card-text
                                    button.btn.btn-outline-success.text-btn(type="button") Send


        footer.py-1.bg-dark.text-white-50.fixed-bottom
            .container.text-center
                small Developer by Max Koroliov

        script(src='../../../../js/jquery-3.3.1.min.js')
        script(src='../../../../js/popper.min.js')
        script(src='../../../../js/bootstrap.min.js')
        script.
            $('form[name="authentfication"]').submit((e) => {
                e.preventDefault();
                console.log($('form[name="authentfication"]')[0]);
                let login = $('form[name="authentfication"]')[0].elements['login'].value;
                let pass = $('form[name="authentfication"]')[0].elements['pass'].value;
                console.log(login);
                if (login && pass) {
                    $.ajax({
                        url: "../../../../post/auth",
                        contentType: "application/json",
                        method: "POST",
                        data: JSON.stringify({
                            ulogin: login,
                            upass: pass
                        }),
                        success: (resdata) => {
                            document.querySelector('form[name="authentfication"]').outerHTML = '<a class="nav-link" href="#">'+resdata+'</a>';
                        }
                    })
                }
            });

            document.querySelectorAll('ol li').forEach((e, i, arr) => (e.firstChild.textContent.length > 20) ? e.firstChild.textContent = e.textContent[0].toUpperCase() + e.textContent.slice(1, 20) + '...' : e.firstChild.textContent = e.textContent[0].toUpperCase() + e.textContent.slice(1));